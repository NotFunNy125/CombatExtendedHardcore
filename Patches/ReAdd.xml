<?xml version="1.0" encoding="utf-8"?>
<Patch>
    <!--Vanilla-->
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ThingDef[
            defName="Gun_Revolver" or
            defName="Gun_MachinePistol" or
            defName="Gun_Autopistol" or
            defName="CE_FlareGun"
            ]/recipeMaker</xpath>
            <value>
                <recipeUsers>
                    <li>TableMachining</li>
                </recipeUsers>
            </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="Gun_Revolver"]/recipeMaker/researchPrerequisite</xpath>
        <value>
            <researchPrerequisite>CEH_Revolver_Research</researchPrerequisite>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="Gun_Autopistol"]/recipeMaker/researchPrerequisite</xpath>
        <value>
            <researchPrerequisite>CEH_AutoPistol_Research</researchPrerequisite>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="Gun_MachinePistol"]/recipeMaker/researchPrerequisite</xpath>
        <value>
            <researchPrerequisite>CEH_MachinePistol_Research</researchPrerequisite>
        </value>
    </Operation>

    <!--Combat Extended-->
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/RecipeDef[
            defName="MakeFlashbangGrenade" or
            defName="MakeSmokeGrenade"
            ]</xpath>
            <value>
                <recipeUsers>
                    <li>TableMachining</li>
                </recipeUsers>
            </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ThingDef[
            @Name="44MagnumBase" or
            @Name="45ACPBase"
            ]/tradeTags</xpath>
            <value>
                <li>CE_AutoEnableTrade</li>
            </value>
    </Operation>
    
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/RecipeDef[defName="MakeAmmo_44Magnum_HP"]</xpath>
            <value>
                <researchPrerequisite>CEH_Revolver_Research</researchPrerequisite>
            </value>
    </Operation>
    
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/RecipeDef[defName="MakeAmmo_44Magnum_FMJ"]</xpath>
            <value>
                <researchPrerequisite>CEH_44_FMJ_Research</researchPrerequisite>
            </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/RecipeDef[defName="MakeAmmo_44Magnum_AP"]</xpath>
            <value>
                <researchPrerequisite>CEH_44_AP_Research</researchPrerequisite>
            </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/RecipeDef[defName="MakeAmmo_45ACP_HP"]</xpath>
            <value>
                <researchPrerequisite>CEH_AutoPistol_Research</researchPrerequisite>
            </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/RecipeDef[defName="MakeAmmo_45ACP_FMJ"]</xpath>
            <value>
                <researchPrerequisite>CEH_45ACP_FMJ_Research</researchPrerequisite>
            </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/RecipeDef[defName="MakeAmmo_45ACP_AP"]</xpath>
            <value>
                <researchPrerequisite>CEH_45ACP_AP_Research</researchPrerequisite>
            </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/RecipeDef[defName="MakeDisposableRocketLauncher_x1"]</xpath>
            <value>
                <recipeUsers>
                    <li>TableMachining</li>
                  </recipeUsers>
            </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/RecipeDef[
            defName="MakeAmmo_44Magnum_HP" or
            defName="MakeAmmo_44Magnum_FMJ" or
            defName="MakeAmmo_44Magnum_AP" or
            defName="MakeAmmo_45ACP_HP" or
            defName="MakeAmmo_45ACP_FMJ" or
            defName="MakeAmmo_45ACP_AP"
            ]</xpath>
            <value>
                <recipeUsers>
                    <li>AmmoBench</li>
                </recipeUsers>
            </value>
    </Operation>
    
    <Operation Class="PatchOperationFindMod">
		<mods>
			<li>Combat Extended Guns</li>
		</mods>
		<match Class="PatchOperationSequence">
			<operations>
                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[
                        defName="CE_Gun_SWGovernor"
						]/recipeMaker/researchPrerequisite</xpath>
                        <value>
                            <researchPrerequisite>CEH_Revolver_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[
                        defName="CE_Gun_WinchesterNintyFour"
						]/recipeMaker/researchPrerequisite</xpath>
                        <value>
                            <researchPrerequisite>CEH_BoltActionRifles_Research</researchPrerequisite>
                        </value>
                </li>
            </operations>
        </match>
    </Operation>

    <Operation Class="PatchOperationFindMod">
		<mods>
			<li>Combat Extended Guns</li>
		</mods>
		<match Class="PatchOperationSequence">
			<operations>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[
                        defName="CE_Gun_SWGovernor" or
                        defName="CE_Gun_WinchesterNintyFour"
						]/recipeMaker</xpath>
                        <value>
                            <recipeUsers>
                                <li>TableMachining</li>
                            </recipeUsers>
                        </value>
                </li>
            </operations>
        </match>
    </Operation>

    <Operation Class="PatchOperationFindMod">
		<mods>
			<li>Combat Extended Armory</li>
		</mods>
		<match Class="PatchOperationSequence">
			<operations>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[
                        defName="CE_Gun_TaurusJudge" or
                        defName="CE_Gun_Uzi" or
                        defName="CE_Gun_MicroUzi"
						]/recipeMaker</xpath>
                        <value>
                            <recipeUsers>
                                <li>TableMachining</li>
                            </recipeUsers>
                        </value>
                </li>
                
                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[
                        defName="CE_Gun_M1903Springfield" or
                        defName="CE_Gun_M1917Enfield" or
                        defName="CE_Gun_MosinNagant"
						]/recipeMaker/researchPrerequisite</xpath>
                        <value>
                            <researchPrerequisite>CEH_BoltActionRifles_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[
                        defName="CE_Gun_BigBoy" or
                        defName="CE_Gun_WinchesterEightySix"
						]/recipeMaker/researchPrerequisite</xpath>
                        <value>
                            <researchPrerequisite>CEH_LeverActionRifles_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[
                        defName="CE_Gun_M1Garand"
						]/recipeMaker/researchPrerequisite</xpath>
                        <value>
                            <researchPrerequisite>CEH_SemiAutomaticRifles_Research</researchPrerequisite>
                        </value>
                </li>
                
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[
                        defName="CE_Gun_MosinNagant" or
                        defName="CE_Gun_WinchesterEightySix" or
                        defName="CE_Gun_BigBoy" or
                        defName="CE_Gun_M1Garand"
                        ]/recipeMaker</xpath>
                        <value>
                            <recipeUsers>
                                <li>TableMachining</li>
                              </recipeUsers>
                        </value>
                </li>

                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[
                        defName="CE_Gun_MicroUzi" or
                        defName="CE_Gun_Uzi"
						]/recipeMaker/researchPrerequisite</xpath>
                        <value>
                            <researchPrerequisite>CEH_MachinePistol_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>Defs/RecipeDef[
                        defName="MakeAmmo_9x19mmPara_HP"
                        ]</xpath>
                        <value>
                            <researchPrerequisite>CEH_MachinePistol_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>Defs/RecipeDef[
                        defName="MakeAmmo_9x19mmPara_FMJ"
                        ]</xpath>
                        <value>
                            <researchPrerequisite>CEH_9x19FMJ_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>Defs/RecipeDef[
                        defName="MakeAmmo_9x19mmPara_AP"
                        ]</xpath>
                        <value>
                            <researchPrerequisite>CEH_9x19AP_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>Defs/RecipeDef[
                        defName="MakeAmmo_762x54mmR_HP"
						]</xpath>
                        <value>
                            <researchPrerequisite>CEH_BoltActionRifles_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>Defs/RecipeDef[
                        defName="MakeAmmo_45Colt_HP" or
                        defName="MakeAmmo_4570Gov_HP"
						]</xpath>
                        <value>
                            <researchPrerequisite>CEH_LeverActionRifles_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>Defs/RecipeDef[
                        defName="MakeAmmo_45Colt_FMJ"
						]</xpath>
                        <value>
                            <researchPrerequisite>CEH_45ColtFMJ_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>Defs/RecipeDef[
                        defName="MakeAmmo_3006Springfield_HP"
						]</xpath>
                        <value>
                            <researchPrerequisite>CEH_SemiAutomaticRifles_Research</researchPrerequisite>
                        </value>
                </li>

                <li Class="PatchOperationAdd">
                    <xpath>Defs/RecipeDef[
                        defName="MakeAmmo_9x19mmPara_HP" or
                        defName="MakeAmmo_9x19mmPara_FMJ" or
                        defName="MakeAmmo_9x19mmPara_AP" or
                        defName="MakeAmmo_762x54mmR_HP" or
                        defName="MakeAmmo_45Colt_HP" or
                        defName="MakeAmmo_4570Gov_HP" or
                        defName="MakeAmmo_45Colt_FMJ" or
                        defName="MakeAmmo_3006Springfield_HP"
                        ]</xpath>
                        <value>
                            <recipeUsers>
                                <li>AmmoBench</li>
                            </recipeUsers>
                        </value>
                </li>
                <!---->
            </operations>
        </match>
    </Operation>
</Patch>